<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" /><title>Ended year game</title>
        <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
        <style type="text/css"> body { margin: 0; }</style>
    </head>


    <body>
        
        
        <script type="text/javascript">

            class scene1 extends Phaser.Scene {
                constructor() {
                    super("scene1");
                }
                preload() {

                    //importation carte        
                    this.load.tilemapTiledJSON("scene1", "LD/scene1.json");


                    //importation tileset
                    this.load.image("jeudetuile","assets/tileset_1.png");
                    
                    
                    
                    //importation consommable
                    /*this.load.image("cigarette", "assets/cigarette_collectible.png");
                    this.load.image("champote", "assets/champignon_collectible_32.png");*/


                    //importation spritesheet héro
                    //animation de déplacement sur le sol, les murs et le plafond

                    this.load.image("hero", "assets/hero.png")
                    this.load.spritesheet("hero_sol_left","assets/hero_sol_left.png",
                    { frameWidth: 64, frameHeight: 64 });
                    this.load.spritesheet("hero_sol_right","assets/hero_sol_right.png",
                    { frameWidth: 64, frameHeight: 64 });
                    this.load.spritesheet("hero_plafond_left","assets/hero_plafond_left.png",
                    { frameWidth: 64, frameHeight: 64 });
                    this.load.spritesheet("hero_plafond_right","assets/hero_plafond_right.png",
                    { frameWidth: 64, frameHeight: 64 });
                    this.load.spritesheet("hero_mur_right_up","assets/hero_mur_right_up.png",
                    { frameWidth: 64, frameHeight:64});
                    this.load.spritesheet("hero_mur_right_down","assets/hero_mur_right_down.png",
                    { frameWidth: 64, frameHeight:64});
                    this.load.spritesheet("hero_mur_left_up","assets/hero_mur_left_up.png",
                    { frameWidth: 64, frameHeight:64});
                    this.load.spritesheet("hero_mur_left_down","assets/hero_mur_left_down.png",
                    { frameWidth: 64, frameHeight:64});

                    //animation dash gauche et droite


                    //importation spritesheet ennemy
                    this.load.spritesheet("ants","assets/fourmi_mob_test_1.png",
                    { frameWidth: 64, frameHeight: 64});


                    //importation audio

                    this.load.audio("walking_snail", "sound/snail_laugh.mp3")

                }

                create(){

                    // permet de créer la map, les collisions, et les déplacements
       
                    const carteDuNiveau = this.add.tilemap("scene1");

                    // importer les TileSet
                    const tileset = carteDuNiveau.addTilesetImage(
                    "tileset_1",
                    "jeudetuile"
                    ); 

                    const background = carteDuNiveau.createLayer(
                    "background",
                    tileset, 
                    );

                    const sol = carteDuNiveau.createLayer(
                    "sol",
                    tileset, 
                    );

                    const gros_champ = carteDuNiveau.createLayer(
                    "gros_champ",
                    tileset, 
                    );

                    const champotes = carteDuNiveau.createLayer(
                    "champotes",
                    tileset,
                    );

                    const clef = carteDuNiveau.createLayer(
                    "clef",
                    tileset, 
                    );

                    const door = carteDuNiveau.createLayer(
                    "door",
                    tileset,
                    );

                    const grass = carteDuNiveau.createLayer(
                    "grass",
                    tileset, 
                    );

                    const trees = carteDuNiveau.createLayer(
                    "trees",  
                    tileset,
                    );

                    sol.setCollisionByProperty({ collider: true });
                    door.setCollisionByProperty({ collider: true });

                    //création caméra
                    this.cameras.main.setSize(896, 448); 

                    this.player = this.physics.add.sprite(200, 6144, "hero")/*.setOrigin(128,128)*/;
                    this.player.setCollideWorldBounds(true);
                    //this.player.setGravity(300)
                    this.physics.add.collider(this.player, sol);
                    this.physics.add.collider(this.player, door);




                    //creation animation

                    this.cursors = this.input.keyboard.createCursorKeys();

                    //animation joueur

                    this.anims.create({
                    key: 'sol_left',
                    frames: this.anims.generateFrameNumbers('hero_sol_left', {start:0,end:3}),
                    frameRate: 10,
                    repeat: -1
                    });

                    this.anims.create({
                    key: 'sol_right',
                    frames: this.anims.generateFrameNumbers('hero_sol_right', {start:0,end:3}),
                    frameRate: 10,
                    repeat: -1
                    });

                    this.anims.create({
                    key: 'mur_left_up',
                    frames: this.anims.generateFrameNumbers('hero_mur_left_up', {start:0,end:3}),
                    frameRate: 10,
                    repeat: -1
                    });

                    this.anims.create({
                    key: 'mur_left_down',
                    frames: this.anims.generateFrameNumbers('hero_mur_left_down', {start:0,end:3}),
                    frameRate: 10,
                    repeat: -1
                    });

                    this.anims.create({
                    key: 'mur_right_up',
                    frames: this.anims.generateFrameNumbers('hero_mur_right_up', {start:0,end:3}),
                    frameRate: 10,
                    repeat: -1
                    });

                    this.anims.create({
                    key: 'mur_right_down',
                    frames: this.anims.generateFrameNumbers('hero_mur_right_down', {start:0,end:3}),
                    frameRate: 10,
                    repeat: -1
                    });

                    this.anims.create({
                    key: 'plafond_left',
                    frames: this.anims.generateFrameNumbers('hero_plafond_left', {start:0,end:3}),
                    frameRate: 10,
                    repeat: -1
                    });

                    this.anims.create({
                    key: 'plafond_right',
                    frames: this.anims.generateFrameNumbers('hero_plafond_right', {start:0,end:3}),
                    frameRate: 10,
                    repeat: -1
                    });

                    this.anims.create({
                    key: 'hero',
                    frames: [ { key: 'hero_sol_right'} ],
                    frameRate: 20
                    });
                    
                    //animation adverssaire

                    //collecChampote 
                    
                    /*this.champote = this.physics.add.staticGroup({
                    key: 'champote',
                    repeat: 11,
                    immovable: true,
                    setXY: { x: 200, y: 6250, stepX: 128 }
                    });                 

                    this.champote.children.iterate(function (child) {

                        child.setBounceY(Phaser.Math.FloatBetween(0.4, 0.8));

                    });*/

                    this.physics.add.collider(this.champote, sol);
                    this.physics.add.overlap(this.player, this.champote, this.collectChampote, null, this);

                    function collectChampote (player, champote)
                    {
                        this.champote.body.enable = false;
                    }

                

                        


                    // caméra 

                    this.cameras.main.setBounds(0,0,6336,6336);
                    this.cameras.main.startFollow(this.player);
                    this.physics.world.setBounds(0,0,6336,6336);

                    var walking_snail = this.sound.add('walking_snail')


                    
                        
                                        
                                        
                    }


                update(){

                    if (this.cursors.left.isDown){ //si la touche gauche est appuyée
                        this.player.setVelocityX(-160); //alors vitesse négative en X
                        this.player.anims.play('sol_left', true); //et animation => gauche
                        }
                        else if (this.cursors.right.isDown){ //sinon si la touche droite est appuyée
                        this.player.setVelocityX(160); //alors vitesse positive en X
                        this.player.anims.play('sol_right', true); //et animation => droite
                        }
                        else{ // sinon
                        this.player.setVelocityX(0); //vitesse nulle
                        this.player.anims.play('hero'); //animation fait face caméra
                    }
                    if (this.player.body.onFloor()) {
                        
                        if (this.cursors.up.isDown && this.player.body.onFloor()){
                        //si touche haut appuyée ET que le perso touche le sol
                        this.player.setVelocityY(-330); //alors vitesse verticale négative
                        //(on saute)
                        }
                        
                    }

                    if (this.player.body.onWall()) {

                        if (this.cursors.up.isDown && this.player.body.onWall()){
                        //si touche haut appuyée ET que le perso touche le sol
                        this.player.setVelocityY(-160); //alors vitesse verticale négative
                        if(this.player.body.blocked.left){
                            this.player.anims.play('mur_left_up');
                        }else{
                            this.player.anims.play('mur_right_up');
                        }
                        if(this.player.body.velocity.y > 0){
                            if(this.player.body.blocked.left){
                                this.player.anims.play('mur_left_down');
                            }else{
                                this.player.anims.play('mur_right_down');
                            }
                        }
                       
                        //(on saute)
                        }
                    }


                    if (this.player.body.onCeiling()) {

                        
                        if (this.cursors.right.isDown && this.player.body.onCeiling()){
                        //si touche haut appuyée ET que le perso touche le sol
                        this.player.setVelocityY(-160); //alors vitesse verticale négative
                        this.player.anims.play('plafond_right');
                        
                        }

                        if (this.cursors.left.isDown && this.player.body.onCeiling()){
                        //si touche haut appuyée ET que le perso touche le sol
                        this.player.setVelocityY(-160); //alors vitesse verticale négative
                        this.player.anims.play('plafond_left');
                        
                        }

                        
                     
                        
                    }

                    
                  
                }

                onWall()
                {
                    return (this.blocked.left || this.blocked.right);
                }


                onCeiling()
                {
                    return this.blocked.up;
                }


                

                /*

                Dash()
                {
                    var speed = 10;

                    if(Phaser.Input.Keyboard.JustDown(scene.mainButtoms.R)){ //I choose the buttom R to be the dash button, but could be anyone.
                    sprite.setVelocityX(speed * 2);

                    }else if(Phaser.Input.Keyboard.UpDuration(scene.mainButtoms.R, 1000)){
                        sprite.setVelocityX(speed); // or sprite.setVelocityX(0)

                    }
                }*/

                
            }





        

            var config = {
                type: Phaser.AUTO,
                width: 896,
                height: 448,
                parent: 'phaser-example',
                physics: {
                    default: 'arcade',
                    arcade: {
                        debug: true,
                        gravity: { y: 400 }
                    }
                },
            scene : [scene1] //Titlescreen scene2 scene3 à rajouter au début  
            };
                new Phaser.Game(config);





        </script>

    </body>